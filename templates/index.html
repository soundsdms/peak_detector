<!DOCTYPE html>
<html>
<head>
    <title>Peak Detection Tool</title>
    <style>
        body {
            font-family: Arial;
            background: #f4f4f4;
            padding: 30px;
        }
        .container {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 0 12px rgba(0,0,0,0.1);
        }
        .slider {
            width: 100%;
        }
        #progressBar {
            width: 100%;
            background: #ddd;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
            display: none;
        }
        #progressFill {
            height: 100%;
            width: 0%;
            background: #4caf50;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>Upload a Video</h2>

    <label>Sensitivity (Peak Prominence)</label>
    <input type="range" min="0.05" max="0.5" step="0.01" value="0.15" id="sensitivity" class="slider">

    <label>Minimum Spacing (Seconds)</label>
    <input type="range" min="0.1" max="2" step="0.1" value="0.5" id="spacing" class="slider">

    <br><br>
    <input type="file" id="videoFile">
    <button onclick="startProcess()">Process</button>

    <div id="progressBar"><div id="progressFill"></div></div>
</div>

<script>
function startProcess() {
    let file = document.getElementById("videoFile").files[0];
    if (!file) { alert("Please upload a video."); return; }

    let data = new FormData();
    data.append("video", file);
    data.append("sensitivity", document.getElementById("sensitivity").value);
    data.append("spacing", document.getElementById("spacing").value);

    document.getElementById("progressBar").style.display = "block";

    fetch("/process", { method: "POST", body: data })
        .then(() => pollProgress());
}

function pollProgress() {
    fetch("/progress")
        .then(r => r.json())
        .then(data => {
            document.getElementById("progressFill").style.width = data.percent + "%";

            if (data.status === "processing") {
                setTimeout(pollProgress, 500);
            } else {
                window.location = "/result?file=" + data.status;
            }
        });
}
</script>
</body>
</html>
